language: go

branches:
  except:
    - gh-pages

go:
  - release

env:
  GOCOVMODE: "mode: count"
  GO15VENDOREXPERIMENT: "1"

git:
  submodules: false

build_image: shippableimages/ubuntu1404_go

before_install:
  - source $HOME/.gvm/scripts/gvm;
  - if [[ $SHIPPABLE_GO_VERSION == "tip" ]]; then gvm install tip; gvm use tip; fi
  - if [[ $SHIPPABLE_GO_VERSION == *release* ]]; then gvm install release; gvm use release; fi
  - if [[ $SHIPPABLE_GO_VERSION =~ [0-9].[0-9] ]]; then gvm install go$SHIPPABLE_GO_VERSION; gvm use go$SHIPPABLE_GO_VERSION; fi
  - export GOPATH=$SHIPPABLE_GOPATH
  - go get -u -v golang.org/x/tools/cmd/goimports
  - go get -u -v golang.org/x/tools/cmd/cover
  - go get -u -v golang.org/x/tools/cmd/vet
  - go get -u -v golang.org/x/tools/cmd/stringer
  - go get -u -v golang.org/x/tools/cmd/gotype
  - go get -u -v golang.org/x/tools/cmd/godoc

  # code coverage
  - go get -u -v github.com/axw/gocov/gocov
  - go get -u -v gopkg.in/matm/v1/gocov-html
  - go get -u -v github.com/t-yuki/gocover-cobertura

  # test output
  - go get -t -v -u  github.com/cee-dub/go-junit-report

  # get the dependencies etc
  - go get github.com/tools/godep
  - go get github.com/jteeuwen/go-bindata/...

install:

  # restore dependencies
  - godep restore

before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage

script:
  - ./scripts/build-shippable.sh
